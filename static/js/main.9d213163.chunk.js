(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,a){e.exports=a(20)},18:function(e,t,a){},20:function(e,t,a){"use strict";a.r(t);var i=a(3),o=a(0),n=a.n(o),r=a(4),c=a.n(r),d=(a(18),{root:{backgroundColor:"#111",color:"crimson",padding:20}}),s=function(){return n.a.createElement("div",{style:d.root},"Castor")},u=a(2),l=a(6),h=a(7),v=a(10),m=a(8),b=a(11),g=a(1),p=a(9),w={root:{backgroundColor:"#333",border:"1px solid #222",padding:10,fontSize:"2em"},active:{backgroundColor:"#99ff99"}},f=function(e){var t=e.text,a=e.active,i=e.onClick;return n.a.createElement("button",{style:a?Object(p.a)({},w.root,w.active):w.root,onClick:i},t)},y={"1080p":{width:1920,height:1080},"720p":{width:1280,height:720}},j={audio:{audio:!0},camera:{video:!0},screen:{video:{mediaSource:"screen"}}},k={root:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:20},canvas:{backgroundColor:"#666",maxWidth:"100%",maxHeight:"100vh"},toolbar:{position:"absolute",bottom:"10%",display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignItems:"center"},toolbarGroup:{padding:10}},E=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(v.a)(this,Object(m.a)(t).call(this,e))).canvas=null,a.recorder=null,a.recordedBlobs=[],a.state={audio:!1,camera:!1,screen:!1,resolution:"720p",isRecording:!1,isPaused:!1},a.update=a.update.bind(Object(g.a)(Object(g.a)(a))),a.getUserMedia=a.getUserMedia.bind(Object(g.a)(Object(g.a)(a))),a.record=a.record.bind(Object(g.a)(Object(g.a)(a))),a.pause=a.pause.bind(Object(g.a)(Object(g.a)(a))),a.stop=a.stop.bind(Object(g.a)(Object(g.a)(a))),a}return Object(b.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){console.log("componentDidMount"),this.update()}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount")}},{key:"update",value:function(){var e=this.canvas,t=this.state,a=(t.audio,t.camera),i=t.screen;if(e){var o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),i&&i.video&&o.drawImage(i.video,0,0,e.width,e.height),a&&a.video&&(o.save(),o.beginPath(),o.arc(e.width-a.video.videoWidth/4+20,e.height-a.video.videoHeight/4-15,a.video.videoHeight/4,0,2*Math.PI),o.closePath(),o.clip(),o.drawImage(a.video,e.width-a.video.videoWidth/2+20,e.height-a.video.videoHeight/2-15,a.video.videoWidth/2,a.video.videoHeight/2),o.restore()),window.requestAnimationFrame(this.update)}}},{key:"getUserMedia",value:function(e){var t=this;if(this.state[e])return this.setState(Object(u.a)({},e,!1));navigator.mediaDevices.getUserMedia(j[e]).then(function(a){"audio"===e?t.setState(Object(u.a)({},e,function(e){return{stream:e}}(a))):t.setState(Object(u.a)({},e,function(e){var t=e.getVideoTracks()[0].getSettings(),a=document.createElement("video");return a.setAttribute("width",t.width),a.setAttribute("height",t.height),a.srcObject=e,a.play(),{stream:e,video:a}}(a)))}).catch(function(a){return t.setState(Object(u.a)({},e,{error:a}))})}},{key:"record",value:function(){var e=this;if(!this.state.isRecording){var t=new MediaStream;Object(i.a)(this.state.audio&&this.state.audio.stream?[this.state.audio.stream]:[]).concat(Object(i.a)(this.state.camera||this.state.screen?[this.canvas.captureStream()]:[])).forEach(function(e){return e.getTracks().forEach(function(e){return t.addTrack(e)})}),this.recordedBlobs=[],this.recorder=new MediaRecorder(t,{mimeType:"video/webm"}),this.recorder.addEventListener("dataavailable",function(t){t.data&&t.data.size>0&&e.recordedBlobs.push(t.data)}),this.recorder.start(1e3),this.setState({isRecording:!0,isPaused:!1})}}},{key:"pause",value:function(){this.state.isPaused?(this.recorder.resume(),this.setState({isRecording:!0,isPaused:!1})):(this.recorder.pause(),this.setState({isRecording:!0,isPaused:!0}))}},{key:"stop",value:function(){var e=this;this.recorder.stop();var t=new Blob(this.recordedBlobs,{type:"video/webm"}),a=window.URL.createObjectURL(t),i=document.createElement("a");i.style.display="none",i.href=a,i.download="test.webm",document.body.appendChild(i),i.click(),setTimeout(function(){document.body.removeChild(i),window.URL.revokeObjectURL(a),e.setState({isRecording:!1,isPaused:!1})},100)}},{key:"render",value:function(){var e=this,t=this.state,a=t.audio,i=t.camera,o=t.screen,r=t.resolution,c=t.isRecording,d=t.isPaused;return console.log(r),n.a.createElement("div",{style:k.root},n.a.createElement("canvas",{width:y[r].width,height:y[r].height,style:k.canvas,ref:function(t){e.canvas=t}}),n.a.createElement("div",{style:k.toolbar},n.a.createElement("select",{disabled:c,value:r,onChange:function(t){return e.setState({resolution:t.target.value})}},Object.keys(y).map(function(e){return n.a.createElement("option",{key:e,value:e},e)})),n.a.createElement("div",{style:k.toolbarGroup},n.a.createElement(f,{text:"\ud83c\udf99",active:!!a,onClick:function(){return e.getUserMedia("audio")}}),n.a.createElement(f,{text:"\ud83c\udfa5",active:!!i,onClick:function(){return e.getUserMedia("camera")}}),n.a.createElement(f,{text:"\ud83d\udcbb",active:!!o,onClick:function(){return e.getUserMedia("screen")}})),n.a.createElement("div",{style:k.toolbarGroup},c?n.a.createElement(f,{text:"\u23f9",active:c,onClick:this.stop}):n.a.createElement(f,{text:"\u23fa",active:c,onClick:this.record}),c&&n.a.createElement(f,{text:d?"\u25b6\ufe0f":"\u23f8\ufe0f",active:d,onClick:this.pause}))))}}]),t}(n.a.Component),O=function(){return n.a.createElement("div",null,n.a.createElement(s,null),n.a.createElement(E,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var C=[window.HTMLCanvasElement,window.HTMLVideoElement,window.Blob,window.requestAnimationFrame,(window.URL||{}).createObjectURL,(window.URL||{}).revokeObjectURL,(navigator.mediaDevices||{}).getUserMedia,window.MediaStream,window.MediaRecorder].reduce(function(e,t){return"function"!==typeof t?Object(i.a)(e).concat([t.name]):e},[]);C.length?c.a.render(n.a.createElement("div",{style:{color:"crimson",padding:20}},"Unsupported features: ",C.join(", ")),document.getElementById("root")):c.a.render(n.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[12,2,1]]]);
//# sourceMappingURL=main.9d213163.chunk.js.map