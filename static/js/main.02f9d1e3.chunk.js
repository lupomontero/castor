(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,a){e.exports=a(20)},19:function(e,t,a){},20:function(e,t,a){"use strict";a.r(t);var i=a(0),o=a.n(i),n=a(5),r=a.n(n),c=(a(19),{root:{backgroundColor:"#111",color:"crimson",padding:20}}),d=function(){return o.a.createElement("div",{style:c.root},"Castor")},s=a(3),u=a(2),l=a(10),h=a(6),v=a(7),m=a(12),g=a(8),b=a(1),p=a(11),f=a(9),w={root:{backgroundColor:"#333",border:"1px solid #222",padding:10,fontSize:"2em"},active:{backgroundColor:"#99ff99"}},k=function(e){var t=e.text,a=e.active,i=e.onClick;return o.a.createElement("button",{style:a?Object(f.a)({},w.root,w.active):w.root,onClick:i},t)},y={"1080p":{width:1920,height:1080},"720p":{width:1280,height:720}},E={audio:{audio:!0},camera:{video:!0},screen:{video:{mediaSource:"screen"}}},j={root:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:20},canvas:{backgroundColor:"#000",maxWidth:"100%",maxHeight:"100vh"},toolbar:{position:"absolute",bottom:"10%",display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignItems:"center"},toolbarGroup:{padding:10}},C=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(m.a)(this,Object(g.a)(t).call(this,e))).canvas=null,a.recorder=null,a.recordedBlobs=[],a.state={audio:!1,camera:!1,screen:!1,resolution:"720p",isRecording:!1,isPaused:!1},a.update=a.update.bind(Object(b.a)(a)),a.getUserMedia=a.getUserMedia.bind(Object(b.a)(a)),a.record=a.record.bind(Object(b.a)(a)),a.pause=a.pause.bind(Object(b.a)(a)),a.stop=a.stop.bind(Object(b.a)(a)),a}return Object(p.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){console.log("componentDidMount"),this.update()}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount")}},{key:"drawScreen",value:function(e,t,a){var i=t.width/t.height,o=e.video.videoWidth/e.video.videoHeight,n=i>o?[t.height*o,t.height,(t.width-t.height*o)/2,0]:[t.width,t.width*o,0,(t.height-t.width*o)/2],r=Object(l.a)(n,4),c=r[0],d=r[1],s=r[2],u=r[3];a.drawImage(e.video,s,u,c,d)}},{key:"drawCamera",value:function(e,t,a){a.save(),a.beginPath(),a.arc(t.width-e.video.videoWidth/4+20,t.height-e.video.videoHeight/4-15,e.video.videoHeight/4,0,2*Math.PI),a.closePath(),a.clip(),a.drawImage(e.video,t.width-e.video.videoWidth/2+20,t.height-e.video.videoHeight/2-15,e.video.videoWidth/2,e.video.videoHeight/2),a.restore()}},{key:"update",value:function(){var e=this.canvas,t=this.state,a=(t.audio,t.camera),i=t.screen;if(e){var o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),i&&i.video&&this.drawScreen(i,e,o),a&&a.video&&this.drawCamera(a,e,o),window.requestAnimationFrame(this.update)}}},{key:"getUserMedia",value:function(e){var t=this;if(this.state[e])return this.setState(Object(u.a)({},e,!1));navigator.mediaDevices.getUserMedia(E[e]).then(function(a){"audio"===e?t.setState(Object(u.a)({},e,function(e){return{stream:e}}(a))):t.setState(Object(u.a)({},e,function(e){var t=e.getVideoTracks()[0].getSettings(),a=document.createElement("video");return a.setAttribute("width",t.width),a.setAttribute("height",t.height),a.srcObject=e,a.play(),{stream:e,video:a}}(a)))}).catch(function(a){return t.setState(Object(u.a)({},e,{error:a}))})}},{key:"record",value:function(){var e=this;if(!this.state.isRecording){var t=new MediaStream;[].concat(Object(s.a)(this.state.audio&&this.state.audio.stream?[this.state.audio.stream]:[]),Object(s.a)(this.state.camera||this.state.screen?[this.canvas.captureStream()]:[])).forEach(function(e){return e.getTracks().forEach(function(e){return t.addTrack(e)})}),this.recordedBlobs=[],this.recorder=new MediaRecorder(t,{mimeType:"video/webm"}),this.recorder.addEventListener("dataavailable",function(t){t.data&&t.data.size>0&&e.recordedBlobs.push(t.data)}),this.recorder.start(1e3),this.setState({isRecording:!0,isPaused:!1})}}},{key:"pause",value:function(){this.state.isPaused?(this.recorder.resume(),this.setState({isRecording:!0,isPaused:!1})):(this.recorder.pause(),this.setState({isRecording:!0,isPaused:!0}))}},{key:"stop",value:function(){var e=this;this.recorder.stop();var t=new Blob(this.recordedBlobs,{type:"video/webm"}),a=window.URL.createObjectURL(t),i=document.createElement("a");i.style.display="none",i.href=a,i.download="test.webm",document.body.appendChild(i),i.click(),setTimeout(function(){document.body.removeChild(i),window.URL.revokeObjectURL(a),e.setState({isRecording:!1,isPaused:!1})},100)}},{key:"render",value:function(){var e=this,t=this.state,a=t.audio,i=t.camera,n=t.screen,r=t.resolution,c=t.isRecording,d=t.isPaused;return o.a.createElement("div",{style:j.root},o.a.createElement("canvas",{width:y[r].width,height:y[r].height,style:j.canvas,ref:function(t){e.canvas=t}}),o.a.createElement("div",{style:j.toolbar},o.a.createElement("select",{disabled:c,value:r,onChange:function(t){return e.setState({resolution:t.target.value})}},Object.keys(y).map(function(e){return o.a.createElement("option",{key:e,value:e},e)})),o.a.createElement("div",{style:j.toolbarGroup},o.a.createElement(k,{text:"\ud83c\udf99",active:!!a,onClick:function(){return e.getUserMedia("audio")}}),o.a.createElement(k,{text:"\ud83c\udfa5",active:!!i,onClick:function(){return e.getUserMedia("camera")}}),o.a.createElement(k,{text:"\ud83d\udcbb",active:!!n,onClick:function(){return e.getUserMedia("screen")}})),o.a.createElement("div",{style:j.toolbarGroup},c?o.a.createElement(k,{text:"\u23f9",active:c,onClick:this.stop}):o.a.createElement(k,{text:"\u23fa",active:c,onClick:this.record}),c&&o.a.createElement(k,{text:d?"\u25b6\ufe0f":"\u23f8\ufe0f",active:d,onClick:this.pause}))))}}]),t}(o.a.Component),O=function(){return o.a.createElement("div",null,o.a.createElement(d,null),o.a.createElement(C,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[13,1,2]]]);
//# sourceMappingURL=main.02f9d1e3.chunk.js.map